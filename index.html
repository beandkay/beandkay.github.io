<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="author" content="Kemal Erdem">

    <title>PyTorch Basic Tutorial Part 2</title>

    <link rel="stylesheet" href="dist/reset.css">
    <link rel="stylesheet" href="dist/reveal.css">
    <link rel="stylesheet" href="dist/theme/black.css" id="theme">

    <!-- Theme used for syntax highlighting of code -->
    <!--    <link rel="stylesheet" href="css/highlight/isbl-editor-light.css">-->
    <link rel="stylesheet" href="plugin/highlight/monokai.css" id="highlight-theme">
</head>
<body>
<div class="reveal">
    <div class="slides">
        <section data-background-transition="zoom">
            <h2>PyTorch</h2>
            <p>This is a basic tutorial about Pytorch application to computer vision</p>
            <small>Binh Nguyen</small>
        </section>

        <section data-background-transition="zoom" data-auto-animate>
            <h3 data-id="code-title">Initial assumptions</h3>
            <p class="fragment">You know how "standard" DL training loop looks like</p>
            <p class="fragment">You (more-less) know how PyTorch works</p>

        </section>

        <section data-background-transition="zoom" data-auto-animate>
            <h3 data-id="code-title">Core libraries</h3>
            <ul>
                <li class="fragment">torch (Core library)</li>
                <li class="fragment">torch.optim (Core optimizers library)</li>
                <li class="fragment">torch.nn (Core neural networks library)</li>
                <li class="fragment">torch.nn.functional (Core neural networks functions library)</li>
                <li class="fragment">torch.utils (Utilities library)</li>
                <li class="fragment">torchvision (Core vision library)</li>
            </ul>
        </section>

        <section data-background-transition="zoom" data-auto-animate>
            <h3 data-id="code-title">Quick recap</h3>
            <p>Torch model</p>
            <pre data-id="code-animation"><code class="hljs" data-trim data-line-numbers="|4-8|9-14">
class Net(nn.Module):
    def __init__(self):
        super(Net, self).__init__()
        self.conv1 = nn.Conv2d(3, 6, 5)
        self.pool = nn.MaxPool2d(2, 2)
        self.conv2 = nn.Conv2d(6, 16, 5)
        self.fc1 = nn.Linear(16 * 5 * 5, 120)
        self.fc2 = nn.Linear(120, 10)
    def forward(self, x):
        x = self.pool(F.relu(self.conv1(x)))
        x = self.pool(F.relu(self.conv2(x)))
        x = x.view(-1, 16 * 5 * 5)
        x = F.relu(self.fc1(x))
        return self.fc2(x)
					</code></pre>
        </section>

        <section data-background-transition="zoom" data-auto-animate>
            <h3 data-id="code-title">Quick recap</h3>
            <p>Loss and activation functions</p>
            <pre data-id="code-animation"><code class="hljs" data-trim data-line-numbers="|1-2|4|6-9|11|12">
optimizer = optim.SGD(model.parameters(),
    lr=0.01, momentum=0.9)

optimizer = optim.Adam([var1, var2], lr=0.0001)

optimizer = optim.SGD([
    {'params': model.base.parameters()},
    {'params': model.classifier.parameters(), 'lr': 1e-3}
    ], lr=1e-2, momentum=0.9)

criterion = nn.CrossEntropyLoss()
criterion = nn.BCELoss
					</code></pre>
        </section>

        <section data-background-transition="zoom" data-auto-animate>
            <h3 data-id="code-title">Quick recap</h3>
            <p>Torch training loop</p>
            <pre data-id="code-animation"><code class="hljs" data-trim data-line-numbers="|5|8|9|10|11">
for epoch in range(EPOCHS):
    for i, data in enumerate(trainloader, 0):
        inputs, labels = data

        optimizer.zero_grad()

        # forward + backward + optimize
        outputs = net(inputs)
        loss = criterion(outputs, labels)
        loss.backward()
        optimizer.step()

        # print statistics
        ...
					</code></pre>
        </section>

        <section data-background-transition="zoom" data-auto-animate>
            <h3 data-id="code-title">One more thing, I need Tensorboard logging</h3>

            <pre data-id="code-animation" class="fragment"><code class="hljs" data-trim data-line-numbers="|1-2|5|12|16-19">
from torch.utils.tensorboard import SummaryWriter
writer = SummaryWriter()

for epoch in range(EPOCHS):
    loss = 0
    for i, data in enumerate(trainloader, 0):
        inputs, labels = data
        optimizer.zero_grad()

        outputs = net(inputs)
        # Compute loss function
        loss += criterion(outputs, labels)
        loss.backward()
        optimizer.step()

        if phase = "training":
            writer.add_scalar('Loss/train', loss)
        elif phase = "test":
            writer.add_scalar('Loss/test', loss)
					</code></pre>
        </section>

        <section data-background-transition="zoom" data-auto-animate>
            <h4 data-id="code-title">Actually, I would rather use W&B then Tensorboard, can we change that?</h4>
            <pre data-id="code-animation" class="fragment"><code class="hljs" data-trim data-line-numbers="|1|5-8">
import wandb
for epoch in range(EPOCHS):
    ...

    if phase = "training":
        wandb.log({'epoch': epoch, 'train_loss': loss})
    elif phase = "test":
        wandb.log({'epoch': epoch, 'test_loss': loss})
					</code></pre>
        </section>

        <section data-background-transition="zoom" data-auto-animate>
            <h3 data-id="code-title">You know what?</h3>

            <p data-id="code-title">Nvidia gave us a GPU</p>

            <p data-id="code-title">Can we run this code using CUDA?</p>

            <pre data-id="code-animation" class="fragment"><code class="hljs" data-trim
                                                                 data-line-numbers="1, 2, 7, 8">

device = torch.device("cuda:0" if torch.cuda.is_available() else "cpu")
model = model.to(device)

for epoch in range(EPOCHS):
    for i, data in enumerate(trainloader, 0):
        inputs, labels = data
        inputs = inputs.to(device)
        labels = labels.to(device)

        optimizer.zero_grad()

        outputs = net(inputs)
        loss += criterion(outputs, labels)  # Compute loss function
        ...
					</code></pre>
        </section>

        <section data-background-transition="zoom">
            <h3 data-id="code-title">And how to run that on multiple GPUs?</h3>
            <pre data-id="code-animation" class="fragment"><code class="hljs" data-trim
                                                                 data-line-numbers="1, 2, 7, 8">
model = model.to(device) # Not this one
model = nn.DataParallel(model, devices_id=[0,1,2,3]) # This
					</code></pre>
        </section>

        <section data-background-transition="zoom">
            <h3>Thank you for your time</h3>
            <p>Feel free to ask any question</p>
            <p>
                <small>Binh Nguyen</small><br/>
                <small>Presentation available at:<br> <a
                        href="https://beandkay.github.io/#">beandkay.github.io/#</a></small><br/>
            </p>
        </section>
    </div>


    <script src="dist/reveal.js"></script>
    <script src="plugin/notes/notes.js"></script>
    <script src="plugin/markdown/markdown.js"></script>
    <script src="plugin/highlight/highlight.js"></script>
    <script src="plugin/math/math.js"></script>
    <script>
      // More info about config & dependencies:
      // - https://github.com/hakimel/reveal.js#configuration
      // - https://github.com/hakimel/reveal.js#dependencies
      Reveal.initialize({
        hash: true,
        controls: true,
        progress: true,
        slideNumber: true,
        overview: true,
        center: true,
        navigationMode: 'default',
        fragmentInURL: false,
        embedded: false,
        preloadIframes: null,
        autoSlide: 0,
        autoSlideStoppable: true,
        defaultTiming: 120,
        mouseWheel: false,
        previewLinks: false,
        transition: 'slide', // none/fade/slide/convex/concave/zoom
        transitionSpeed: 'fast', // default/fast/slow
        backgroundTransition: 'fade', // none/fade/slide/convex/concave/zoom
        display: 'block',
        math: {
          mathjax: 'plugin/math/MathJax.js',
          config: 'TeX-AMS_HTML-full', // See http://docs.mathjax.org/en/latest/config-files.html
          // pass other options into `MathJax.Hub.Config()`
          TeX: {Macros: {RR: '{\\bf R}'}},
        },
        plugins: [RevealMarkdown, RevealHighlight, RevealNotes, RevealMath],
      });
    </script>
</body>
</html>




